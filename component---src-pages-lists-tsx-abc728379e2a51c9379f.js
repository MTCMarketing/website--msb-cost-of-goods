"use strict";(self.webpackChunkslap_kommerce_web=self.webpackChunkslap_kommerce_web||[]).push([[682],{473:function(e,t,n){n.d(t,{Cg:function(){return r},Ep:function(){return i},FG:function(){return f},Ii:function(){return o},Jc:function(){return u},Q3:function(){return d},QA:function(){return m},Wl:function(){return c},ZE:function(){return E},Zr:function(){return a},fj:function(){return s},sm:function(){return p}});var l=n(5937);async function r(){const{data:e,error:t}=await l.N.from("price_items").select("uid, name, sku, bulk, carton");return t?(console.error("Error fetching price items:",t.message),[]):e.map(e=>({uid:e.uid,item:e.name,sku:e.sku,bulk:parseFloat(e.bulk),carton:parseInt(e.carton),qty:1,sell:0}))}async function a(e){const{data:t,error:n}=await l.N.from("price_items").select("*").eq("uid",e).single();return n?(console.error("Fetch item error:",n.message),null):t}async function o(e,t){const{error:n}=await l.N.from("price_items").update(t).eq("uid",e);return{success:!n,error:n}}async function i(){const{count:e,error:t}=await l.N.from("price_items").select("uid",{count:"exact",head:!0});if(t)return console.error("Error counting rows in price_items:",t.message),null;return`SKU-${((null!=e?e:0)+1).toString().padStart(3,"0")}`}async function s(){const{data:e,error:t}=await l.N.from("supply_list_meta").select("list_name").order("list_name",{ascending:!0});return t?(console.error("Error fetching list names from meta:",t.message),[]):e.map(e=>e.list_name)}async function c(e){const{data:t,error:n}=await l.N.from("supply_list").select("\n      quantity,\n      sell,\n      item:price_items (\n        uid,\n        name,\n        sku,\n        bulk,\n        carton\n      )\n    ").eq("list_name",e);if(n)return console.error("Error fetching supply list details:",n.message),{items:[],meta:null};const r=(t||[]).map(e=>{var t,n;const l=parseFloat(e.item.bulk)/e.item.carton,r=parseFloat(null!==(t=e.sell)&&void 0!==t?t:0),a=null!==(n=e.quantity)&&void 0!==n?n:1,o=(r-l)*a;return{uid:e.item.uid,item:e.item.name,sku:e.item.sku,bulk:parseFloat(e.item.bulk),carton:e.item.carton,costEa:l,qty:a,sell:r,profit:o}}),{data:a,error:o}=await l.N.from("supply_list_meta").select("margin, shipping_rate").eq("list_name",e).limit(1).single();return o&&console.error("Error fetching supply list meta:",o.message),{items:r,meta:a||null}}async function u(e,t,n){void 0===n&&(n=!1);const r=(t||[]).filter(e=>e.uid&&"number"==typeof e.qty&&"number"==typeof e.sell).map(t=>({list_name:e,item_uid:t.uid,quantity:t.qty>0?t.qty:1,sell:isNaN(t.sell)?0:parseFloat(t.sell)}));if(0===r.length)return console.warn("âš ï¸ No valid items to upsert."),!1;const{error:a}=n?await l.N.from("supply_list").upsert(r,{onConflict:["list_name","item_uid"]}):await l.N.from("supply_list").insert(r);return!a||(console.error(`âŒ Error ${n?"upserting":"inserting"} supply list items:`,a.message),!1)}async function m(e,t,n){if(void 0===n&&(n=!0),!t.length)return console.warn("âš ï¸ No valid items to upsert."),!1;const{error:r}=await l.N.from("supply_list").upsert(t,{onConflict:["list_name","item_uid"]});return!r||(console.error("âŒ Supabase upsert error:",r.message),!1)}async function p(e,t,n){const{error:r}=await l.N.from("supply_list_meta").upsert([{list_name:e,margin:t,shipping_rate:n}],{onConflict:["list_name"]});return!r||(console.error("âŒ Supabase error saving supply_list_meta:",r.message),!1)}async function d(e){const{data:t,error:n}=await l.N.from("supply_list_meta").select("list_name").eq("list_name",e).limit(1);return n?(console.error("Error checking list name:",n.message),!1):!!(t&&t.length>0)}async function f(e){const{data:t,error:n}=await l.N.from("supply_list_meta").select("margin, shipping_rate").eq("list_name",e).limit(1).single();return n?(console.error("Error fetching supply list meta:",n.message),null):t}async function E(e){const{error:t}=await l.N.from("supply_list").delete().eq("list_name",e),{error:n}=await l.N.from("supply_list_meta").delete().eq("list_name",e);return!t&&!n||(console.error("âŒ Failed to delete list:",(null==t?void 0:t.message)||(null==n?void 0:n.message)),!1)}},4399:function(e,t,n){var l=n(6540),r=n(4794);t.A=e=>{let{children:t}=e;return l.createElement(l.Fragment,null,l.createElement("nav",{style:{display:"flex",gap:"1rem",padding:"10px",background:"#f0f0f0",borderBottom:"1px solid #ccc",flexWrap:"wrap"}},l.createElement(r.Link,{to:"/",style:{marginRight:10}},"âœï¸ Lists"),l.createElement(r.Link,{to:"/list-builder"},"ðŸ“¥ New List"),l.createElement(r.Link,{to:"/item-builder"},"ðŸ“¥ New Item"),l.createElement(r.Link,{to:"/bottom-line"},"ðŸ“¤ Average Profit Margin")),l.createElement("main",{style:{padding:"20px"}},t))}},5166:function(e,t,n){n.r(t),n.d(t,{default:function(){return u}});var l=n(6540),r=n(4399),a=n(4506),o=n(6462),i=n(4794),s=n(473);function c(){const e=(0,o.useLocation)().pathname.split("/").filter(Boolean)[1]||"",t=decodeURIComponent(e),{0:n,1:r}=(0,l.useState)([]),{0:c,1:u}=(0,l.useState)(null),{0:m,1:p}=(0,l.useState)(!0),{0:d,1:f}=(0,l.useState)(!1),{0:E,1:y}=(0,l.useState)(!1),{0:g,1:_}=(0,l.useState)(30),{0:b,1:k}=(0,l.useState)(""),{0:h,1:v}=(0,l.useState)("");(0,l.useEffect)(()=>{if(!t)return;(async()=>{var e;const[n,l]=await Promise.all([(0,s.Wl)(t),(0,s.FG)(t)]),a=n.items.map(e=>{const t=e.bulk/e.carton,n=t*e.qty,l=e.sell*e.qty,r=(e.sell-t)*e.qty;return{...e,costEa:t,costTotal:n,totalRetail:l,profit:r}});r(a),u(null!==(e=null==l?void 0:l.desired_margin)&&void 0!==e?e:null),p(!1)})()},[t]);const q=(0,l.useMemo)(()=>n.reduce((e,t)=>(e.bulk+=t.bulk,e.cost+=t.costEa*t.qty,e.retail+=t.sell*t.qty,e.profit+=t.profit,e),{bulk:0,cost:0,retail:0,profit:0}),[n]),S=q.retail>0?q.profit/q.retail*100:0;return m?l.createElement("div",{style:{padding:20}},"Loading..."):l.createElement("div",{style:{padding:20,fontFamily:"Arial"}},l.createElement("h2",null,"Supply List: ",t),E&&l.createElement("div",{style:{padding:10,background:"#eee",marginBottom:20,border:"1px solid #aaa"}},l.createElement("label",null,l.createElement("strong",null,"Profit Margin (%): ")),l.createElement("input",{type:"number",value:g,onChange:e=>_(parseFloat(e.target.value)||0),style:{width:60,marginLeft:10}}),l.createElement("button",{onClick:()=>{const e=n.map(e=>{const t=e.bulk/e.carton,n=t/(1-g/100),l=(n-t)*e.qty;return{...e,sell:parseFloat(n.toFixed(2)),costEa:t,costTotal:t*e.qty,totalRetail:n*e.qty,profit:l}});r(e),y(!1)},style:{marginLeft:10,padding:"4px 12px"}},"Apply"),l.createElement("button",{onClick:()=>y(!1),style:{marginLeft:10}},"Cancel")),l.createElement("table",{border:1,cellPadding:6,cellSpacing:0},l.createElement("thead",null,l.createElement("tr",null,l.createElement("th",null,"ITEM"),l.createElement("th",null,"BULK"),l.createElement("th",null,"CARTON"),l.createElement("th",null,"COST EA."),l.createElement("th",null,"COST TL."),l.createElement("th",null,"QTY"),l.createElement("th",null,"SELL"),l.createElement("th",null,"TOTAL"),l.createElement("th",null,"PROFIT"))),l.createElement("tbody",null,n.map((e,t)=>l.createElement("tr",{key:e.sku},l.createElement("td",{onClick:()=>(0,i.navigate)(`/items/${e.uid}`),style:{cursor:"pointer",textDecoration:"underline",color:"#007acc"}},e.item),l.createElement("td",null,e.bulk),l.createElement("td",null,e.carton),l.createElement("td",null,"$",e.costEa.toFixed(2)),l.createElement("td",null,"$",e.costTotal.toFixed(2)),l.createElement("td",null,l.createElement("input",{type:"number",value:e.qty,onChange:e=>((e,t,l)=>{const o=(0,a.A)(n),i=parseFloat(l)||0;o[e][t]=i;const{bulk:s,carton:c,qty:u,sell:m}=o[e],p=s/c,d=p*u,f=m*u,E=(m-p)*u;o[e].costEa=p,o[e].costTotal=d,o[e].totalRetail=f,o[e].profit=E,r(o)})(t,"qty",e.target.value),style:{width:60}})),l.createElement("td",null,"$",e.sell.toFixed(2)),l.createElement("td",null,"$",e.totalRetail.toFixed(2)),l.createElement("td",null,"$",e.profit.toFixed(2)))),l.createElement("tr",null,l.createElement("td",{colSpan:5},l.createElement("strong",null,"Bulk Total")),l.createElement("td",{colSpan:4},"$",q.bulk.toFixed(2))),l.createElement("tr",null,l.createElement("td",{colSpan:5},l.createElement("strong",null,"Expenses")),l.createElement("td",{colSpan:4},"$",q.cost.toFixed(2))),l.createElement("tr",null,l.createElement("td",{colSpan:5},l.createElement("strong",null,"Revenue")),l.createElement("td",{colSpan:4},"$",q.retail.toFixed(2))),l.createElement("tr",null,l.createElement("td",{colSpan:5},l.createElement("strong",null,"Profit")),l.createElement("td",{colSpan:4},"$",q.profit.toFixed(2))),l.createElement("tr",null,l.createElement("td",{colSpan:5},l.createElement("strong",null,"Current Margin")),l.createElement("td",{colSpan:4},S.toFixed(2),"%")))),l.createElement("button",{onClick:async()=>{f(!0),v(""),k("");const e=n.filter(e=>e.uid&&"number"==typeof e.qty&&"number"==typeof e.sell).map(e=>({item_uid:e.uid,list_name:t,quantity:e.qty>0?parseInt(e.qty,10):1,sell:isNaN(e.sell)?0:parseFloat(e.sell)}));if(0===e.length)return v("âŒ No valid items to save."),void f(!1);await(0,s.sm)(t,null!=c?c:0,0)&&await(0,s.QA)(t,e,!0)?k("âœ… Saved successfully!"):v("âŒ Failed to save."),f(!1)},disabled:d,style:{marginTop:20,padding:"8px 16px"}},d?"Saving...":"ðŸ’¾ Save Changes"),h&&l.createElement("p",{style:{color:"red"}},h),b&&l.createElement("p",{style:{color:"green"}},b))}var u=()=>l.createElement(r.A,null,l.createElement(c,null))}}]);
//# sourceMappingURL=component---src-pages-lists-tsx-abc728379e2a51c9379f.js.map