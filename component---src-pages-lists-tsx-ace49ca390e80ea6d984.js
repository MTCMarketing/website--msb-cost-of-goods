"use strict";(self.webpackChunkslap_kommerce_web=self.webpackChunkslap_kommerce_web||[]).push([[682],{473:function(e,t,l){l.d(t,{Cg:function(){return r},FG:function(){return m},Jc:function(){return i},Q3:function(){return u},QA:function(){return s},Wl:function(){return o},ZE:function(){return p},fj:function(){return a},sm:function(){return c}});var n=l(5937);async function r(){const{data:e,error:t}=await n.N.from("price_items").select("uid, name, sku, bulk, carton");return t?(console.error("Error fetching price items:",t.message),[]):e.map(e=>({uid:e.uid,item:e.name,sku:e.sku,bulk:parseFloat(e.bulk),carton:parseInt(e.carton),qty:1,sell:0}))}async function a(){const{data:e,error:t}=await n.N.from("supply_list_meta").select("list_name").order("list_name",{ascending:!0});return t?(console.error("Error fetching list names from meta:",t.message),[]):e.map(e=>e.list_name)}async function o(e){const{data:t,error:l}=await n.N.from("supply_list").select("\n      quantity,\n      sell,\n      item:price_items (\n        uid,\n        name,\n        sku,\n        bulk,\n        carton\n      )\n    ").eq("list_name",e);if(l)return console.error("Error fetching supply list details:",l.message),{items:[],meta:null};const r=(t||[]).map(e=>{var t,l;const n=parseFloat(e.item.bulk)/e.item.carton,r=parseFloat(null!==(t=e.sell)&&void 0!==t?t:0),a=null!==(l=e.quantity)&&void 0!==l?l:1,o=(r-n)*a;return{uid:e.item.uid,item:e.item.name,sku:e.item.sku,bulk:parseFloat(e.item.bulk),carton:e.item.carton,costEa:n,qty:a,sell:r,profit:o}}),{data:a,error:o}=await n.N.from("supply_list_meta").select("margin, shipping_rate").eq("list_name",e).limit(1).single();return o&&console.error("Error fetching supply list meta:",o.message),{items:r,meta:a||null}}async function i(e,t,l){void 0===l&&(l=!1);const r=(t||[]).filter(e=>e.uid&&"number"==typeof e.qty&&"number"==typeof e.sell).map(t=>({list_name:e,item_uid:t.uid,quantity:t.qty>0?t.qty:1,sell:isNaN(t.sell)?0:parseFloat(t.sell)}));if(0===r.length)return console.warn("⚠️ No valid items to upsert."),!1;const{error:a}=l?await n.N.from("supply_list").upsert(r,{onConflict:["list_name","item_uid"]}):await n.N.from("supply_list").insert(r);return!a||(console.error(`❌ Error ${l?"upserting":"inserting"} supply list items:`,a.message),!1)}async function s(e,t,l){if(void 0===l&&(l=!0),!t.length)return console.warn("⚠️ No valid items to upsert."),!1;const{error:r}=await n.N.from("supply_list").upsert(t,{onConflict:["list_name","item_uid"]});return!r||(console.error("❌ Supabase upsert error:",r.message),!1)}async function c(e,t,l){const{error:r}=await n.N.from("supply_list_meta").upsert([{list_name:e,margin:t,shipping_rate:l}],{onConflict:["list_name"]});return!r||(console.error("❌ Supabase error saving supply_list_meta:",r.message),!1)}async function u(e){const{data:t,error:l}=await n.N.from("supply_list_meta").select("list_name").eq("list_name",e).limit(1);return l?(console.error("Error checking list name:",l.message),!1):!!(t&&t.length>0)}async function m(e){const{data:t,error:l}=await n.N.from("supply_list_meta").select("margin, shipping_rate").eq("list_name",e).limit(1).single();return l?(console.error("Error fetching supply list meta:",l.message),null):t}async function p(e){const{error:t}=await n.N.from("supply_list").delete().eq("list_name",e),{error:l}=await n.N.from("supply_list_meta").delete().eq("list_name",e);return!t&&!l||(console.error("❌ Failed to delete list:",(null==t?void 0:t.message)||(null==l?void 0:l.message)),!1)}},1532:function(e,t,l){l.r(t),l.d(t,{default:function(){return c}});var n=l(6540),r=l(4399),a=l(4506),o=l(6462),i=l(473);function s(){const e=(0,o.useLocation)().pathname.split("/").filter(Boolean)[1]||"",t=decodeURIComponent(e),{0:l,1:r}=(0,n.useState)([]),{0:s,1:c}=(0,n.useState)(null),{0:u,1:m}=(0,n.useState)(!0),{0:p,1:d}=(0,n.useState)(!1),{0:f,1:E}=(0,n.useState)(!1),{0:g,1:y}=(0,n.useState)(30),{0:_,1:b}=(0,n.useState)(""),{0:k,1:h}=(0,n.useState)("");(0,n.useEffect)(()=>{if(!t)return;(async()=>{var e;const[l,n]=await Promise.all([(0,i.Wl)(t),(0,i.FG)(t)]),a=l.items.map(e=>{const t=e.bulk/e.carton,l=t*e.qty,n=e.sell*e.qty,r=(e.sell-t)*e.qty;return{...e,costEa:t,costTotal:l,totalRetail:n,profit:r}});r(a),c(null!==(e=null==n?void 0:n.desired_margin)&&void 0!==e?e:null),m(!1)})()},[t]);const v=(e,t,n)=>{const o=(0,a.A)(l),i="item"===t?n:parseFloat(n)||0;o[e][t]=i;const{bulk:s,carton:c,qty:u,sell:m}=o[e],p=s/c,d=p*u,f=m*u,E=(m-p)*u;o[e].costEa=p,o[e].costTotal=d,o[e].totalRetail=f,o[e].profit=E,r(o)},q=(0,n.useMemo)(()=>l.reduce((e,t)=>(e.bulk+=t.bulk,e.cost+=t.costEa*t.qty,e.retail+=t.sell*t.qty,e.profit+=t.profit,e),{bulk:0,cost:0,retail:0,profit:0}),[l]),S=q.retail>0?q.profit/q.retail*100:0;return u?n.createElement("div",{style:{padding:20}},"Loading..."):n.createElement("div",{style:{padding:20,fontFamily:"Arial"}},n.createElement("h2",null,"Supply List: ",t),n.createElement("button",{onClick:()=>E(!0),style:{marginBottom:10}},"📈 Set All to X% Profit Margin"),f&&n.createElement("div",{style:{padding:10,background:"#eee",marginBottom:20,border:"1px solid #aaa"}},n.createElement("label",null,n.createElement("strong",null,"Profit Margin (%): ")),n.createElement("input",{type:"number",value:g,onChange:e=>y(parseFloat(e.target.value)||0),style:{width:60,marginLeft:10}}),n.createElement("button",{onClick:()=>{const e=l.map(e=>{const t=e.bulk/e.carton,l=t/(1-g/100),n=(l-t)*e.qty;return{...e,sell:parseFloat(l.toFixed(2)),costEa:t,costTotal:t*e.qty,totalRetail:l*e.qty,profit:n}});r(e),E(!1)},style:{marginLeft:10,padding:"4px 12px"}},"Apply"),n.createElement("button",{onClick:()=>E(!1),style:{marginLeft:10}},"Cancel")),n.createElement("table",{border:1,cellPadding:6,cellSpacing:0},n.createElement("thead",null,n.createElement("tr",null,n.createElement("th",null,"ITEM"),n.createElement("th",null,"BULK"),n.createElement("th",null,"CARTON"),n.createElement("th",null,"COST EA."),n.createElement("th",null,"COST TL."),n.createElement("th",null,"QTY"),n.createElement("th",null,"SELL"),n.createElement("th",null,"TOTAL"),n.createElement("th",null,"PROFIT"))),n.createElement("tbody",null,l.map((e,t)=>n.createElement("tr",{key:e.sku},n.createElement("td",null,n.createElement("input",{value:e.item,onChange:e=>v(t,"item",e.target.value)})),n.createElement("td",null,e.bulk),n.createElement("td",null,e.carton),n.createElement("td",null,"$",e.costEa.toFixed(2)),n.createElement("td",null,"$",e.costTotal.toFixed(2)),n.createElement("td",null,n.createElement("input",{type:"number",value:e.qty,onChange:e=>v(t,"qty",e.target.value),style:{width:60}})),n.createElement("td",null,n.createElement("input",{type:"number",value:e.sell,onChange:e=>v(t,"sell",e.target.value),style:{width:60}})),n.createElement("td",null,"$",e.totalRetail.toFixed(2)),n.createElement("td",null,"$",e.profit.toFixed(2)))),n.createElement("tr",null,n.createElement("td",{colSpan:5},n.createElement("strong",null,"Bulk Total")),n.createElement("td",{colSpan:4},"$",q.bulk.toFixed(2))),n.createElement("tr",null,n.createElement("td",{colSpan:5},n.createElement("strong",null,"Expenses")),n.createElement("td",{colSpan:4},"$",q.cost.toFixed(2))),n.createElement("tr",null,n.createElement("td",{colSpan:5},n.createElement("strong",null,"Revenue")),n.createElement("td",{colSpan:4},"$",q.retail.toFixed(2))),n.createElement("tr",null,n.createElement("td",{colSpan:5},n.createElement("strong",null,"Profit")),n.createElement("td",{colSpan:4},"$",q.profit.toFixed(2))),n.createElement("tr",null,n.createElement("td",{colSpan:5},n.createElement("strong",null,"Current Margin")),n.createElement("td",{colSpan:4},S.toFixed(2),"%")))),n.createElement("button",{onClick:async()=>{d(!0),h(""),b("");const e=l.filter(e=>e.uid&&"number"==typeof e.qty&&"number"==typeof e.sell).map(e=>({item_uid:e.uid,list_name:t,quantity:e.qty>0?parseInt(e.qty,10):1,sell:isNaN(e.sell)?0:parseFloat(e.sell)}));if(0===e.length)return h("❌ No valid items to save."),void d(!1);await(0,i.sm)(t,null!=s?s:0,0)&&await(0,i.QA)(t,e,!0)?b("✅ Saved successfully!"):h("❌ Failed to save."),d(!1)},disabled:p,style:{marginTop:20,padding:"8px 16px"}},p?"Saving...":"💾 Save Changes"),k&&n.createElement("p",{style:{color:"red"}},k),_&&n.createElement("p",{style:{color:"green"}},_))}var c=()=>n.createElement(r.A,null,n.createElement(s,null))},4399:function(e,t,l){var n=l(6540),r=l(4794);t.A=e=>{let{children:t}=e;return n.createElement(n.Fragment,null,n.createElement("nav",{style:{display:"flex",gap:"1rem",padding:"10px",background:"#f0f0f0",borderBottom:"1px solid #ccc",flexWrap:"wrap"}},n.createElement(r.Link,{to:"/",style:{marginRight:10}},"✍️ Lists"),n.createElement(r.Link,{to:"/builder"},"📥 New"),n.createElement(r.Link,{to:"/bottom-line"},"📤 Average Profit Margin")),n.createElement("main",{style:{padding:"20px"}},t))}}}]);
//# sourceMappingURL=component---src-pages-lists-tsx-ace49ca390e80ea6d984.js.map