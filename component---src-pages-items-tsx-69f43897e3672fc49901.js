"use strict";(self.webpackChunkslap_kommerce_web=self.webpackChunkslap_kommerce_web||[]).push([[649],{473:function(e,t,n){n.d(t,{Cg:function(){return a},Ep:function(){return s},FG:function(){return f},Ii:function(){return i},Jc:function(){return u},Q3:function(){return d},QA:function(){return m},Wl:function(){return c},ZE:function(){return g},Zr:function(){return l},fj:function(){return o},sm:function(){return p}});var r=n(5937);async function a(){const{data:e,error:t}=await r.N.from("price_items").select("uid, name, sku, bulk, carton");return t?(console.error("Error fetching price items:",t.message),[]):e.map(e=>({uid:e.uid,item:e.name,sku:e.sku,bulk:parseFloat(e.bulk),carton:parseInt(e.carton),qty:1,sell:0}))}async function l(e){const{data:t,error:n}=await r.N.from("price_items").select("*").eq("uid",e).single();return n?(console.error("Fetch item error:",n.message),null):t}async function i(e,t){const{error:n}=await r.N.from("price_items").update(t).eq("uid",e);return{success:!n,error:n}}async function s(){const{count:e,error:t}=await r.N.from("price_items").select("uid",{count:"exact",head:!0});if(t)return console.error("Error counting rows in price_items:",t.message),null;return`SKU-${((null!=e?e:0)+1).toString().padStart(3,"0")}`}async function o(){const{data:e,error:t}=await r.N.from("supply_list_meta").select("list_name").order("list_name",{ascending:!0});return t?(console.error("Error fetching list names from meta:",t.message),[]):e.map(e=>e.list_name)}async function c(e){const{data:t,error:n}=await r.N.from("supply_list").select("\n      quantity,\n      sell,\n      item:price_items (\n        uid,\n        name,\n        sku,\n        bulk,\n        carton\n      )\n    ").eq("list_name",e);if(n)return console.error("Error fetching supply list details:",n.message),{items:[],meta:null};const a=(t||[]).map(e=>{var t,n;const r=parseFloat(e.item.bulk)/e.item.carton,a=parseFloat(null!==(t=e.sell)&&void 0!==t?t:0),l=null!==(n=e.quantity)&&void 0!==n?n:1,i=(a-r)*l;return{uid:e.item.uid,item:e.item.name,sku:e.item.sku,bulk:parseFloat(e.item.bulk),carton:e.item.carton,costEa:r,qty:l,sell:a,profit:i}}),{data:l,error:i}=await r.N.from("supply_list_meta").select("margin, shipping_rate").eq("list_name",e).limit(1).single();return i&&console.error("Error fetching supply list meta:",i.message),{items:a,meta:l||null}}async function u(e,t,n){void 0===n&&(n=!1);const a=(t||[]).filter(e=>e.uid&&"number"==typeof e.qty&&"number"==typeof e.sell).map(t=>({list_name:e,item_uid:t.uid,quantity:t.qty>0?t.qty:1,sell:isNaN(t.sell)?0:parseFloat(t.sell)}));if(0===a.length)return console.warn("âš ï¸ No valid items to upsert."),!1;const{error:l}=n?await r.N.from("supply_list").upsert(a,{onConflict:["list_name","item_uid"]}):await r.N.from("supply_list").insert(a);return!l||(console.error(`âŒ Error ${n?"upserting":"inserting"} supply list items:`,l.message),!1)}async function m(e,t,n){if(void 0===n&&(n=!0),!t.length)return console.warn("âš ï¸ No valid items to upsert."),!1;const{error:a}=await r.N.from("supply_list").upsert(t,{onConflict:["list_name","item_uid"]});return!a||(console.error("âŒ Supabase upsert error:",a.message),!1)}async function p(e,t,n){const{error:a}=await r.N.from("supply_list_meta").upsert([{list_name:e,margin:t,shipping_rate:n}],{onConflict:["list_name"]});return!a||(console.error("âŒ Supabase error saving supply_list_meta:",a.message),!1)}async function d(e){const{data:t,error:n}=await r.N.from("supply_list_meta").select("list_name").eq("list_name",e).limit(1);return n?(console.error("Error checking list name:",n.message),!1):!!(t&&t.length>0)}async function f(e){const{data:t,error:n}=await r.N.from("supply_list_meta").select("margin, shipping_rate").eq("list_name",e).limit(1).single();return n?(console.error("Error fetching supply list meta:",n.message),null):t}async function g(e){const{error:t}=await r.N.from("supply_list").delete().eq("list_name",e),{error:n}=await r.N.from("supply_list_meta").delete().eq("list_name",e);return!t&&!n||(console.error("âŒ Failed to delete list:",(null==t?void 0:t.message)||(null==n?void 0:n.message)),!1)}},3670:function(e,t,n){n.r(t),n.d(t,{default:function(){return s}});var r=n(6540),a=n(6462),l=n(473),i=n(4399);function s(){const e=(0,a.useLocation)().pathname.split("/").filter(Boolean)[1]||"",t=decodeURIComponent(e),{0:n,1:s}=(0,r.useState)(null),{0:o,1:c}=(0,r.useState)(!1),{0:u,1:m}=(0,r.useState)(""),{0:p,1:d}=(0,r.useState)(""),{0:f,1:g}=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{const e=await(0,l.Zr)(t);if(!e)return d("âŒ Item not found."),void g(!1);const n=e.bulk/e.carton,r=e.price_each-n;s({...e,costEa:n,profit:r}),g(!1)})()},[t]);const _=(e,t)=>{const r={...n,[e]:t},a=r.bulk/r.carton,l=r.price_each-a;r.costEa=a,r.profit=l,s(r)},y=n&&n.price_each>0?n.profit/n.price_each*100:0;return r.createElement(i.A,null,f?r.createElement("div",{style:{padding:20}},"Loading..."):r.createElement("div",{style:{padding:20,fontFamily:"Arial"}},r.createElement("h2",null,"Edit Item: ",n.name),r.createElement("table",{border:1,cellPadding:6,cellSpacing:0},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,"Item"),r.createElement("th",null,"Bulk"),r.createElement("th",null,"Carton"),r.createElement("th",null,"Cost Ea."),r.createElement("th",null,"Sell"),r.createElement("th",null,"Profit"),r.createElement("th",null,"Margin"))),r.createElement("tbody",null,r.createElement("tr",null,r.createElement("td",null,n.name),r.createElement("td",null,r.createElement("input",{type:"number",value:n.bulk,onChange:e=>_("bulk",parseFloat(e.target.value)||0),style:{width:80}})),r.createElement("td",null,r.createElement("input",{type:"number",value:n.carton,onChange:e=>_("carton",parseInt(e.target.value)||1),style:{width:60}})),r.createElement("td",null,"$",n.costEa.toFixed(2)),r.createElement("td",null,r.createElement("input",{type:"number",value:n.price_each,onChange:e=>_("price_each",parseFloat(e.target.value)||0),style:{width:80}})),r.createElement("td",null,"$",n.profit.toFixed(2)),r.createElement("td",null,y.toFixed(1),"%")))),r.createElement("button",{onClick:async()=>{c(!0),d(""),m("");const e={bulk:parseFloat(n.bulk),carton:parseInt(n.carton),price_each:parseFloat(n.price_each)},t=await(0,l.Ii)(n.uid,e);null!=t&&t.error?d("âŒ Failed to save."):m("âœ… Item updated!"),c(!1)},disabled:o,style:{marginTop:20,padding:"8px 16px"}},o?"Saving...":"ğŸ’¾ Save"),p&&r.createElement("p",{style:{color:"red"}},p),u&&r.createElement("p",{style:{color:"green"}},u)))}},4399:function(e,t,n){var r=n(6540),a=n(4794);t.A=e=>{let{children:t}=e;return r.createElement(r.Fragment,null,r.createElement("nav",{style:{display:"flex",gap:"1rem",padding:"10px",background:"#f0f0f0",borderBottom:"1px solid #ccc",flexWrap:"wrap"}},r.createElement(a.Link,{to:"/",style:{marginRight:10}},"âœï¸ Lists"),r.createElement(a.Link,{to:"/list-builder"},"ğŸ“¥ New List"),r.createElement(a.Link,{to:"/item-builder"},"ğŸ“¥ New Item"),r.createElement(a.Link,{to:"/bottom-line"},"ğŸ“¤ Average Profit Margin")),r.createElement("main",{style:{padding:"20px"}},t))}}}]);
//# sourceMappingURL=component---src-pages-items-tsx-69f43897e3672fc49901.js.map