"use strict";(self.webpackChunkslap_kommerce_web=self.webpackChunkslap_kommerce_web||[]).push([[671],{213:function(e,t,r){r.r(t),r.d(t,{default:function(){return o}});var n=r(4506),l=r(6540),a=r(473),i=r(5937),s=r(4399);function o(){const{0:e,1:t}=(0,l.useState)([]),{0:r,1:o}=(0,l.useState)(null),{0:c,1:u}=(0,l.useState)(!1),{0:m,1:p}=(0,l.useState)("");(0,l.useEffect)(()=>{(async()=>{const e=await(0,a.Ep)(0);if(!e)return;const r=parseInt(e.replace("SKU-",""));o(r),t([{item:"",sku:f(r),bulk:0,carton:0,price_each:0}])})()},[]);const f=e=>`SKU-${e.toString().padStart(3,"0")}`,d=(r,l,a)=>{const i=(0,n.A)(e);i[r][l]="item"===l||"sku"===l?a:parseFloat(a)||0,t(i)};return l.createElement(s.A,null,l.createElement("div",{style:{padding:20,fontFamily:"Arial"}},l.createElement("h2",null,"Create Items"),0===e.length?l.createElement("p",null,"Loading..."):l.createElement(l.Fragment,null,l.createElement("table",{border:1,cellPadding:6,cellSpacing:0},l.createElement("thead",null,l.createElement("tr",null,l.createElement("th",null,"Item"),l.createElement("th",null,"SKU"),l.createElement("th",null,"Bulk"),l.createElement("th",null,"Carton"),l.createElement("th",null,"Cost Ea."),l.createElement("th",null,"Price Ea."),l.createElement("th",null,"Profit"),l.createElement("th",null,"Profit Margin"),l.createElement("th",null,"❌"))),l.createElement("tbody",null,e.map((r,a)=>{const i=r.carton>0?r.bulk/r.carton:0,s=r.price_each-i,o=i>0?s/i*100:0;return l.createElement("tr",{key:a},l.createElement("td",null,l.createElement("input",{value:r.item,onChange:e=>d(a,"item",e.target.value)})),l.createElement("td",null,l.createElement("input",{value:r.sku,onChange:e=>d(a,"sku",e.target.value)})),l.createElement("td",null,l.createElement("input",{type:"number",value:r.bulk,onChange:e=>d(a,"bulk",e.target.value)})),l.createElement("td",null,l.createElement("input",{type:"number",value:r.carton,onChange:e=>d(a,"carton",e.target.value)})),l.createElement("td",null,"$",i.toFixed(2)),l.createElement("td",null,l.createElement("input",{type:"number",value:r.price_each,onChange:e=>d(a,"price_each",e.target.value)})),l.createElement("td",null,"$",s.toFixed(2)),l.createElement("td",null,o.toFixed(1),"%"),l.createElement("td",null,l.createElement("button",{onClick:()=>(r=>{const l=(0,n.A)(e);l.splice(r,1),t(l)})(a)},"❌")))}))),l.createElement("div",{style:{marginTop:16}},l.createElement("button",{onClick:()=>{if(null===r)return;const l=e.length,a=f(r+l);t(e=>[].concat((0,n.A)(e),[{item:"",sku:a,bulk:0,carton:0,price_each:0}]))}},"➕ Add Row")," ",l.createElement("button",{onClick:async()=>{p("");let r=!1;const n=[],l=e.filter((e,t)=>{const{item:l,sku:a,bulk:i,carton:s}=e;return"string"!=typeof l||""===l.trim()||"string"!=typeof a||""===a.trim()||isNaN(i)||i<=0||isNaN(s)||s<=0?(r=!0,!1):(0===e.price_each&&n.push(t),!0)});if(r)return void alert("❌ Please fill all required fields with valid values before saving.");if(n.length>0){if(!confirm(`⚠️ ${n.length} item(s) have $0 price. Continue anyway?`))return}const a=l.map(e=>{let{item:t,sku:r,bulk:n,carton:l,price_each:a}=e;return{name:t,sku:r,bulk:n,carton:l,price_each:a}});u(!0);try{const{error:r}=await i.N.from("price_items").insert(a);if(r)return console.error("Insert error:",r.message),void p(`❌ Error: ${r.message}`);const n=e.filter(e=>!l.includes(e));t(n),p(`✅ ${a.length} item(s) added successfully!`)}catch(s){console.error("Unexpected error:",s),p("❌ Unexpected error occurred.")}finally{u(!1)}},disabled:c},c?"⏳ Saving...":"💾 Save All"))),m&&l.createElement("p",{style:{marginTop:12}},m)))}},473:function(e,t,r){r.d(t,{Cg:function(){return l},Ep:function(){return s},FG:function(){return d},Ii:function(){return i},Jc:function(){return u},Q3:function(){return f},QA:function(){return m},Wl:function(){return c},ZE:function(){return g},Zr:function(){return a},fj:function(){return o},sm:function(){return p}});var n=r(5937);async function l(){const{data:e,error:t}=await n.N.from("price_items").select("uid, name, sku, bulk, carton");return t?(console.error("Error fetching price items:",t.message),[]):e.map(e=>({uid:e.uid,item:e.name,sku:e.sku,bulk:parseFloat(e.bulk),carton:parseInt(e.carton),qty:1,sell:0}))}async function a(e){const{data:t,error:r}=await n.N.from("price_items").select("*").eq("uid",e).single();return r?(console.error("Fetch item error:",r.message),null):t}async function i(e,t){const{error:r}=await n.N.from("price_items").update(t).eq("uid",e);return{success:!r,error:r}}async function s(){const{count:e,error:t}=await n.N.from("price_items").select("uid",{count:"exact",head:!0});if(t)return console.error("Error counting rows in price_items:",t.message),null;return`SKU-${((null!=e?e:0)+1).toString().padStart(3,"0")}`}async function o(){const{data:e,error:t}=await n.N.from("supply_list_meta").select("list_name").order("list_name",{ascending:!0});return t?(console.error("Error fetching list names from meta:",t.message),[]):e.map(e=>e.list_name)}async function c(e){const{data:t,error:r}=await n.N.from("supply_list").select("\n      quantity,\n      sell,\n      item:price_items (\n        uid,\n        name,\n        sku,\n        bulk,\n        carton\n      )\n    ").eq("list_name",e);if(r)return console.error("Error fetching supply list details:",r.message),{items:[],meta:null};const l=(t||[]).map(e=>{var t,r;const n=parseFloat(e.item.bulk)/e.item.carton,l=parseFloat(null!==(t=e.sell)&&void 0!==t?t:0),a=null!==(r=e.quantity)&&void 0!==r?r:1,i=(l-n)*a;return{uid:e.item.uid,item:e.item.name,sku:e.item.sku,bulk:parseFloat(e.item.bulk),carton:e.item.carton,costEa:n,qty:a,sell:l,profit:i}}),{data:a,error:i}=await n.N.from("supply_list_meta").select("margin, shipping_rate").eq("list_name",e).limit(1).single();return i&&console.error("Error fetching supply list meta:",i.message),{items:l,meta:a||null}}async function u(e,t,r){void 0===r&&(r=!1);const l=(t||[]).filter(e=>e.uid&&"number"==typeof e.qty&&"number"==typeof e.sell).map(t=>({list_name:e,item_uid:t.uid,quantity:t.qty>0?t.qty:1,sell:isNaN(t.sell)?0:parseFloat(t.sell)}));if(0===l.length)return console.warn("⚠️ No valid items to upsert."),!1;const{error:a}=r?await n.N.from("supply_list").upsert(l,{onConflict:["list_name","item_uid"]}):await n.N.from("supply_list").insert(l);return!a||(console.error(`❌ Error ${r?"upserting":"inserting"} supply list items:`,a.message),!1)}async function m(e,t,r){if(void 0===r&&(r=!0),!t.length)return console.warn("⚠️ No valid items to upsert."),!1;const{error:l}=await n.N.from("supply_list").upsert(t,{onConflict:["list_name","item_uid"]});return!l||(console.error("❌ Supabase upsert error:",l.message),!1)}async function p(e,t,r){const{error:l}=await n.N.from("supply_list_meta").upsert([{list_name:e,margin:t,shipping_rate:r}],{onConflict:["list_name"]});return!l||(console.error("❌ Supabase error saving supply_list_meta:",l.message),!1)}async function f(e){const{data:t,error:r}=await n.N.from("supply_list_meta").select("list_name").eq("list_name",e).limit(1);return r?(console.error("Error checking list name:",r.message),!1):!!(t&&t.length>0)}async function d(e){const{data:t,error:r}=await n.N.from("supply_list_meta").select("margin, shipping_rate").eq("list_name",e).limit(1).single();return r?(console.error("Error fetching supply list meta:",r.message),null):t}async function g(e){const{error:t}=await n.N.from("supply_list").delete().eq("list_name",e),{error:r}=await n.N.from("supply_list_meta").delete().eq("list_name",e);return!t&&!r||(console.error("❌ Failed to delete list:",(null==t?void 0:t.message)||(null==r?void 0:r.message)),!1)}},4399:function(e,t,r){var n=r(6540),l=r(4794);t.A=e=>{let{children:t}=e;return n.createElement(n.Fragment,null,n.createElement("nav",{style:{display:"flex",gap:"1rem",padding:"10px",background:"#f0f0f0",borderBottom:"1px solid #ccc",flexWrap:"wrap"}},n.createElement(l.Link,{to:"/",style:{marginRight:10}},"✍️ Lists"),n.createElement(l.Link,{to:"/list-builder"},"📥 New List"),n.createElement(l.Link,{to:"/item-builder"},"📥 New Item"),n.createElement(l.Link,{to:"/bottom-line"},"📤 Average Profit Margin")),n.createElement("main",{style:{padding:"20px"}},t))}}}]);
//# sourceMappingURL=component---src-pages-item-builder-index-tsx-4177b3602b9f7db77137.js.map