"use strict";(self.webpackChunkslap_kommerce_web=self.webpackChunkslap_kommerce_web||[]).push([[591],{473:function(e,t,n){n.d(t,{Cg:function(){return r},FG:function(){return m},Jc:function(){return i},Q3:function(){return c},QA:function(){return o},Wl:function(){return s},ZE:function(){return p},fj:function(){return a},sm:function(){return u}});var l=n(5937);async function r(){const{data:e,error:t}=await l.N.from("price_items").select("uid, name, sku, bulk, carton");return t?(console.error("Error fetching price items:",t.message),[]):e.map(e=>({uid:e.uid,item:e.name,sku:e.sku,bulk:parseFloat(e.bulk),carton:parseInt(e.carton),qty:1,sell:0}))}async function a(){const{data:e,error:t}=await l.N.from("supply_list_meta").select("list_name").order("list_name",{ascending:!0});return t?(console.error("Error fetching list names from meta:",t.message),[]):e.map(e=>e.list_name)}async function s(e){const{data:t,error:n}=await l.N.from("supply_list").select("\n      quantity,\n      sell,\n      item:price_items (\n        uid,\n        name,\n        sku,\n        bulk,\n        carton\n      )\n    ").eq("list_name",e);if(n)return console.error("Error fetching supply list details:",n.message),{items:[],meta:null};const r=(t||[]).map(e=>{var t,n;const l=parseFloat(e.item.bulk)/e.item.carton,r=parseFloat(null!==(t=e.sell)&&void 0!==t?t:0),a=null!==(n=e.quantity)&&void 0!==n?n:1,s=(r-l)*a;return{uid:e.item.uid,item:e.item.name,sku:e.item.sku,bulk:parseFloat(e.item.bulk),carton:e.item.carton,costEa:l,qty:a,sell:r,profit:s}}),{data:a,error:s}=await l.N.from("supply_list_meta").select("margin, shipping_rate").eq("list_name",e).limit(1).single();return s&&console.error("Error fetching supply list meta:",s.message),{items:r,meta:a||null}}async function i(e,t,n){void 0===n&&(n=!1);const r=(t||[]).filter(e=>e.uid&&"number"==typeof e.qty&&"number"==typeof e.sell).map(t=>({list_name:e,item_uid:t.uid,quantity:t.qty>0?t.qty:1,sell:isNaN(t.sell)?0:parseFloat(t.sell)}));if(0===r.length)return console.warn("‚ö†Ô∏è No valid items to upsert."),!1;const{error:a}=n?await l.N.from("supply_list").upsert(r,{onConflict:["list_name","item_uid"]}):await l.N.from("supply_list").insert(r);return!a||(console.error(`‚ùå Error ${n?"upserting":"inserting"} supply list items:`,a.message),!1)}async function o(e,t,n){if(void 0===n&&(n=!0),!t.length)return console.warn("‚ö†Ô∏è No valid items to upsert."),!1;const{error:r}=await l.N.from("supply_list").upsert(t,{onConflict:["list_name","item_uid"]});return!r||(console.error("‚ùå Supabase upsert error:",r.message),!1)}async function u(e,t,n){const{error:r}=await l.N.from("supply_list_meta").upsert([{list_name:e,margin:t,shipping_rate:n}],{onConflict:["list_name"]});return!r||(console.error("‚ùå Supabase error saving supply_list_meta:",r.message),!1)}async function c(e){const{data:t,error:n}=await l.N.from("supply_list_meta").select("list_name").eq("list_name",e).limit(1);return n?(console.error("Error checking list name:",n.message),!1):!!(t&&t.length>0)}async function m(e){const{data:t,error:n}=await l.N.from("supply_list_meta").select("margin, shipping_rate").eq("list_name",e).limit(1).single();return n?(console.error("Error fetching supply list meta:",n.message),null):t}async function p(e){const{error:t}=await l.N.from("supply_list").delete().eq("list_name",e),{error:n}=await l.N.from("supply_list_meta").delete().eq("list_name",e);return!t&&!n||(console.error("‚ùå Failed to delete list:",(null==t?void 0:t.message)||(null==n?void 0:n.message)),!1)}},4399:function(e,t,n){var l=n(6540),r=n(4794);t.A=e=>{let{children:t}=e;return l.createElement(l.Fragment,null,l.createElement("nav",{style:{display:"flex",gap:"1rem",padding:"10px",background:"#f0f0f0",borderBottom:"1px solid #ccc",flexWrap:"wrap"}},l.createElement(r.Link,{to:"/",style:{marginRight:10}},"‚úçÔ∏è Lists"),l.createElement(r.Link,{to:"/builder"},"üì• New"),l.createElement(r.Link,{to:"/bottom-line"},"üì§ Average Profit Margin")),l.createElement("main",{style:{padding:"20px"}},t))}},6551:function(e,t,n){n.r(t),n.d(t,{default:function(){return i}});var l=n(4506),r=n(6540),a=n(473),s=n(4399);function i(){const{0:e,1:t}=(0,r.useState)([]),{0:n,1:i}=(0,r.useState)(!0),{0:o,1:u}=(0,r.useState)(""),{0:c,1:m}=(0,r.useState)(40),{0:p,1:d}=(0,r.useState)(17),{0:g,1:f}=(0,r.useState)(!1),{0:y,1:E}=(0,r.useState)(""),{0:b,1:h}=(0,r.useState)(""),{0:_,1:k}=(0,r.useState)(!1),{0:v,1:w}=(0,r.useState)(30);(0,r.useEffect)(()=>{(0,a.Cg)().then(e=>{const n=e.map(e=>{const t=e.bulk/e.carton;return{...e,selected:!1,qty:1,sell:parseFloat(t.toFixed(2))}});t(n),i(!1)})},[]);const F=(n,r,a)=>{const s=(0,l.A)(e);s[n][r]="qty"===r?parseInt(a)||1:"sell"===r?parseFloat(a)||0:a,t(s)},q=e.filter(e=>e.selected),x=q.reduce((e,t)=>e+t.bulk/t.carton*t.qty,0),C=q.reduce((e,t)=>e+t.sell*t.qty,0),S=q.reduce((e,t)=>e+(t.sell-t.bulk/t.carton)*t.qty,0),N=Math.abs(S)<.005?0:S,L=C>0?N/C*100:0,A=C+p;return n?r.createElement("div",{style:{padding:20}},"Loading..."):r.createElement(s.A,null,r.createElement("div",{style:{padding:20,fontFamily:"Arial"}},r.createElement("h2",null,"Build New Supply List"),r.createElement("div",{style:{marginBottom:10}},r.createElement("label",null,r.createElement("strong",null,"List Name: ")),r.createElement("input",{value:o,onChange:e=>u(e.target.value),style:{marginLeft:10}})),r.createElement("table",{border:1,cellPadding:6,cellSpacing:0},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,"Add"),r.createElement("th",null,"Item"),r.createElement("th",null,"SKU"),r.createElement("th",null,"Cost Ea."),r.createElement("th",null,"Qty"),r.createElement("th",null,"Sell"),r.createElement("th",null,"Profit"))),r.createElement("tbody",null,e.map((e,t)=>{const n=e.bulk/e.carton;let l=(e.sell-n)*e.qty;return Math.abs(l)<.005&&(l=0),r.createElement("tr",{key:e.sku},r.createElement("td",null,r.createElement("input",{type:"checkbox",checked:e.selected,onChange:e=>F(t,"selected",e.target.checked)})),r.createElement("td",null,e.item),r.createElement("td",null,e.sku),r.createElement("td",null,"$",n.toFixed(2)),r.createElement("td",null,r.createElement("input",{type:"number",value:e.qty,onChange:e=>F(t,"qty",e.target.value),disabled:!e.selected,style:{width:60}})),r.createElement("td",null,r.createElement("input",{type:"number",value:e.sell,onChange:e=>F(t,"sell",e.target.value),disabled:!e.selected,style:{width:60}})),r.createElement("td",null,"$",l.toFixed(2)))}))),r.createElement("div",{style:{marginTop:20}},r.createElement("button",{onClick:()=>k(!0),style:{padding:"6px 12px",marginBottom:10}},"üìà Set All to X% Profit Margin"),_&&r.createElement("div",{style:{padding:10,background:"#eee",marginBottom:20,border:"1px solid #aaa"}},r.createElement("label",null,r.createElement("strong",null,"Profit Margin (%): ")),r.createElement("input",{type:"number",value:v,onChange:e=>w(parseFloat(e.target.value)||0),style:{width:60,marginLeft:10}}),r.createElement("button",{onClick:()=>{const n=e.map(e=>{if(!e.selected)return e;const t=e.bulk/e.carton/(1-v/100);return{...e,sell:parseFloat(t.toFixed(2))}});t(n),k(!1)},style:{marginLeft:10,padding:"4px 12px"}},"Apply"),r.createElement("button",{onClick:()=>k(!1),style:{marginLeft:10}},"Cancel")),r.createElement("p",null,r.createElement("label",null,r.createElement("strong",null,"Shipping Rate ($):")),r.createElement("input",{type:"number",value:p,onChange:e=>d(parseFloat(e.target.value)||0),style:{marginLeft:10,width:60}})),r.createElement("hr",null),r.createElement("p",null,r.createElement("strong",null,"Total Cost:")," $",x.toFixed(2)),r.createElement("p",null,r.createElement("strong",null,"Total Profit:")," $",S.toFixed(2)),r.createElement("p",null,r.createElement("strong",null,"Profit Margin:")," ",L.toFixed(2),"%"),r.createElement("p",null,r.createElement("strong",null,"Final Cost to Customer (with Shipping):")," $",A.toFixed(2)),r.createElement("button",{onClick:async()=>{if(f(!0),E(""),h(""),!o.trim())return E("List name is required."),void f(!1);await(0,a.Q3)(o)&&console.warn(`‚ö†Ô∏è Overwriting existing list: ${o}`);const t=await(0,a.sm)(o,c,p),n=e.filter(e=>e.selected&&e.uid),l=await(0,a.Jc)(o,n,!0);t&&l?h("‚úÖ List and items saved successfully!"):E("‚ùå Failed to save list or items."),f(!1)},disabled:g,style:{marginTop:20,padding:"8px 16px"}},g?"Saving...":"Save List"),y&&r.createElement("p",{style:{color:"red"}},y),b&&r.createElement("p",{style:{color:"green"}},b))))}}}]);
//# sourceMappingURL=component---src-pages-builder-index-tsx-822424b71b95a9278cb4.js.map